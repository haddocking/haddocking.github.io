<p>This tutorial consists of the following sections:</p>

<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#setuprequirements" id="markdown-toc-setuprequirements">Setup/Requirements</a></li>
  <li><a href="#inspecting-the-data" id="markdown-toc-inspecting-the-data">Inspecting the data</a></li>
  <li><a href="#rigid-body-fitting" id="markdown-toc-rigid-body-fitting">Rigid body fitting</a>    <ul>
      <li><a href="#step1-register-to-the-server" id="markdown-toc-step1-register-to-the-server">Step1: Register to the server</a></li>
      <li><a href="#step2-define-the-input-files-and-parameters-and-submit" id="markdown-toc-step2-define-the-input-files-and-parameters-and-submit">Step2: Define the input files and parameters and submit</a></li>
    </ul>
  </li>
  <li><a href="#analysing-the-results" id="markdown-toc-analysing-the-results">Analysing the results</a></li>
  <li><a href="#final-remarks" id="markdown-toc-final-remarks">Final remarks</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>PowerFit is a software developed in our lab to fit atomic resolution
structures of biomolecules into cryo-electron microscopy (cryo-EM) density maps.
It is open-source and available for download from our <a href="https://github.com/haddocking/powerfit" title="PowerFit" target="_blank">Github repository</a>.
To facilitate its use, we have developed a <a href="http://haddock.science.uu.nl/services/POWERFIT/" title="PowerFit web server" target="_blank">web portal</a> for it.</p>

<p>This tutorial demonstrates the use of the PowerFit web server. The server makes use of either 
local resources on our cluster, using the multi-core version of the software, or GPGPU-accelerated grid resources of the
<a href="http://www.egi.eu" target="_blank">EGI</a> to speed up the calculations. It only requires a web browser to work and benefits from the latest
developments in the software based on a stable and tested workflow. Next to providing an automated workflow around
PowerFit, the web server also summarizes and higlights the results in a single page including some additional postprocessing
of the PowerFit output using <a href="https://www.cgl.ucsf.edu/chimera/" title="UCSF Chimera" target="_blank">UCSF Chimera</a>.
Chimera is a visualization software and popular tool in the cryo-EM community for its volume visualization capabilities.</p>

<p>The case we will be investigating is a complex between the 30S maturing <em>E. coli</em>
ribosome and RsgA, a GTPase. There are models (<a href="http://www.rcsb.org/pdb/explore/explore.do?structureId=2YKR" title="PDBid 2YKR" target="_blank">2YKR</a>) and a cryo-EM density map of around 9.8Å resolution
(<a href="https://www.ebi.ac.uk/pdbe/entry/emdb/EMD-1884" title="Ribosome RsgA density" target="_blank">EMD-1884</a>) available for the complex.</p>

<p>A related tutorial, based on a local installation of PowerFit can be found <a href="http://bonvinlab.org/education/powerfit" title="Powerfit command-line tutorial" target="_blank">here</a>. It provides a more 
detailed analysis of the results of a run with the methyltransferase KsgA, another 30S ribosome partner, and shows how HADDOCK can be used to obtain higher quality models.</p>

<p>The PowerFit and HADDOCK software are described in:</p>

<ul>
  <li>
    <p>G.C.P. van Zundert, M. Trellet, J. Schaarschmidt, Z. Kurkcuoglu, M. David, M. Verlato, A. Rosato and A.M.J.J. Bonvin.
<a href="https://doi.org/10.1016/j.jmb.2016.11.032" target="_blank">The DisVis and PowerFit web servers: Explorative and Integrative Modeling of Biomolecular Complexes.</a>.
<em>J. Mol. Biol.</em>. <em>429(3)</em>, 399-407 (2016).</p>
  </li>
  <li>
    <p>G.C.P van Zundert and A.M.J.J. Bonvin. 
<a href="https://doi.org/10.1016/j.jsb.2016.06.011" target="_blank">Defining the limits and reliability of rigid-body fitting in cryo-EM maps using multi-scale image pyramids</a>. 
<em>J. Struct. Biol.</em> <em>195</em>, 252-258 (2016).</p>
  </li>
  <li>
    <p>G.C.P. van Zundert and A.M.J.J. Bonvin.
<a href="https://doi.org/doi:10.3934/biophy.2015.2.73" target="_blank">Fast and sensitive rigid-body fitting into cryo-EM density maps with PowerFit</a>.
<em>AIMS Biophysics</em>. <em>2</em>, 73-87 (2015).</p>
  </li>
  <li>
    <p>G.C.P. van Zundert, A.S.J. Melquiond and A.M.J.J. Bonvin.
<a href="https://doi.org/10.1016/j.str.2015.03.014" target="_blank">Integrative modeling of biomolecular complexes: HADDOCKing with Cryo-EM data.</a>.
<em>Structure.</em> <em>23</em>, 949-960 (2015).</p>
  </li>
</ul>

<p>Throughout the tutorial, coloured text will be used to refer to questions, 
instructions, and Chimera commands.</p>

<p><a class="prompt prompt-question">This is a question prompt: try answering 
it!</a>
<a class="prompt prompt-info">This an instruction prompt: follow it!</a>
<a class="prompt prompt-pymol">This is a Chimera prompt: write this in the 
Chimera command line prompt!</a></p>

<h2 id="setuprequirements">Setup/Requirements</h2>

<p>In order to follow this tutorial you only need a <strong>web browser</strong>, a <strong>text editor</strong>, and <a href="https://www.cgl.ucsf.edu/chimera/" title="UCSF Chimera" target="_blank"><strong>UCSF Chimera</strong></a> 
(freely available for most operating systems) on your computer in order to visualise the input and output data.<br />
Further, the required data to run this tutorial should be downloaded <a href="http://milou.science.uu.nl/cgi/services/POWERFIT/powerfit/powerfit-tutorial.tgz" title="PowerFit tutorial data" target="_blank"><strong>here</strong></a>.
Once downloaded, make sure to unpack the archive.</p>

<h2 id="inspecting-the-data">Inspecting the data</h2>

<p>Let us first inspect the data we have available, namely the cryo-EM density map
and the structures we will attempt to fit.</p>

<p>Using Chimera, we can easily visualize and inspect the density and models,
mostly through a few mouse clicks.</p>

<p>For this open the density map <code class="highlighter-rouge">ribosome-RsgA.map</code> and the PDB file of the ribosome which is already fitted into the map <code class="highlighter-rouge">ribosome.pdb</code>.</p>

<p><a class="prompt prompt-info">
  UCSF Chimera Menu → File → Open… → Select the file
</a></p>

<p>Repeat this for each file. Chimera will automatically guess their type.</p>

<p>If you want to use the Chimera command-line instead, you need to first display it:</p>

<p><a class="prompt prompt-info">
  UCSF Chimera Menu → Favorites → Command Line
</a></p>

<p>and type:</p>

<p><a class="prompt prompt-pymol">
  open /path/to/ribosome-RsgA.map
</a>
<a class="prompt prompt-pymol">
  open /path/to/ribosome.pdb
</a></p>

<p>In the <code class="highlighter-rouge">Volume Viewer</code> window, the middle slide bar provides control on the
value at which the isosurface of the density is shown. At high values, the
envelope will shrink while lower values might even display the noise in the map.
In the same window, you can click on <code class="highlighter-rouge">Center</code> to center the view on all visible molecules and the density.</p>

<p>We will first make the density transparent, in order to be able to see the fitted structure inside:</p>

<p><a class="prompt prompt-info">
  Within the Volume Viewer window click on the gray box next to Color
</a></p>

<p>This opens the<code class="highlighter-rouge">Color Editor</code> window.</p>

<p><a class="prompt prompt-info">
Check the Opacity box. 
</a></p>

<p>An extra slider bar appears in the box called A, for the alpha channel.</p>

<p><a class="prompt prompt-info">
Set the alpha channel value to around 0.6.
</a></p>

<p>Notice that the density becomes transparent providing a better view of the fit
of the ribosome model. On closer inspection, you can also discern a region of
the density that is not accounted for by the ribosome structure alone: This should be the
binding location of RsgA. Although you could try and manually place the crystal
structure in that region, finding the correct orientation is not
straightforward. PowerFit can help you here as it will exhaustively sample all possible translations and rotations in order to find the best fit, based on an objective score.</p>

<h2 id="rigid-body-fitting">Rigid body fitting</h2>

<p>PowerFit is a rigid body fitting software that quickly calculates the 
cross-correlation, a common measure of the goodness-of-fit, between the atomic 
structure and the density map. It performs a systematic 6-dimensional scan of 
the three translational and three rotational degrees of freedom. In short, 
PowerFit will try to systematically fit the structure in different orientations at every position 
in the map and calculate a cross-correlation score for each of them.</p>

<p>In order to perform the search PowerFit requires three different things:
a high-resolution atomic structure of the
biomolecule to be fitted (<code class="highlighter-rouge">RsgA.pdb</code>), a target cryo-EM density map to fit the
structure in (<code class="highlighter-rouge">ribosome-RsgA.map</code>), and the resolution, in Ångstrom, of the
density map (<code class="highlighter-rouge">9.8</code>). This is also the minimal required input for the web server in order to setup a run.</p>

<p>To run PowerFit, go to</p>

<p><a class="prompt prompt-info" href="http://haddock.science.uu.nl/services/POWERFIT" target="_blank">http://haddock.science.uu.nl/services/POWERFIT</a></p>

<p>On this page, you will find the most relevant information about the server as well as the links to the local and grid versions of the portal’s submission page.</p>

<h3 id="step1-register-to-the-server">Step1: Register to the server</h3>

<p><a href="http://milou.science.uu.nl/cgi/services/POWERFIT/powerfit/register" title="PowerFit registration" target="_blank">Register</a> for getting access to the webserver (or use the credentials provided in case of a workshop).</p>

<p>You can click on the “<strong>Register</strong>” menu from any PowerFit page and fill the required information.
Registration is not automatic but is usually processed within 12h, so be patient.</p>

<h3 id="step2-define-the-input-files-and-parameters-and-submit">Step2: Define the input files and parameters and submit</h3>

<p>Click on the “<strong>Submit</strong>” menu to access the <a href="http://milou.science.uu.nl/cgi/services/POWERFIT/powerfit/submit" title="PowerFit submission" target="_blank">input form</a>:</p>

<figure align="center">
<img src="/education/powerfit-webserver/powerfit_submission.png" />
</figure>

<p>Complete the form by filling the required fields and selecting the respective files
(most browsers should also support dragging the files onto the selection button):</p>

<p><a class="prompt prompt-info">Cryo-EM map → ribosome-RsgA.map</a>
<a class="prompt prompt-info">Map resolution → 9.8</a>
<a class="prompt prompt-info">Atomic structure → RsgA.pdb</a>
<a class="prompt prompt-info">Rotational angle interval → 10.0</a></p>

<p>Once the fields have been filled in you can submit your job to our server 
by clicking on “<strong>Submit</strong>” at the bottom of the page.</p>

<p>If the input fields have been correctly filled you should be redirected to a status page displaying a pop-up message
indicating that your run has been successfully submitted.
While performing the search, the PowerFit web server will update you on the progress of the 
job by reloading the status page every 30 seconds.
The runtime of this example case is below 5 minutes on our local servers. However the load of the server as well as 
pre- and post-processing steps might substantially increase the time until the results are available.</p>

<p>While the calculations are running, open a second tab and go to</p>

<p><a class="prompt prompt-info" href="http://haddock.science.uu.nl/services/POWERFIT" target="_blank">http://haddock.science.uu.nl/services/POWERFIT</a></p>

<p>Then click on the “<strong>Help/Manual</strong>” menu.</p>

<p>Here, you can have a look at the several features and options of PowerFit and read about the meaning of the various input
parameters (including the ones under “<strong>Advanced options</strong>”).</p>

<p>The rotational sampling interval option is given in
degrees and defines how tightly the three rotational degrees of freedom will be
sampled. Lower values will cause PowerFit to perform a finer search, at the
expense of increased computational time. The default value is 10°, but it can be lowered
to 5° for more sensitive searches, or raised to 20° if time is an issue or if
there aren’t sufficient computational resources. 
The number of processors used for the calculation is fixed on the web server side to 8 processors. 
This number can of course be changed when using the local version of PowerFit.</p>

<h2 id="analysing-the-results">Analysing the results</h2>

<p>Once your job has completed, and provided you did not close the status page, you will be automatically redirected to the results
page (you will also receive an email notification). The results page presents a summary split into several sections:</p>

<ul>
  <li><code class="highlighter-rouge">Status</code>: In this section you will find a link from which you can download the output data as well as some information
about how to cite the use of the portal.</li>
  <li><code class="highlighter-rouge">Solutions</code>: The best 15 non-redundant solutions found, ordered by their
cross correlation score. The first column shows the rank, column 2 the cross correlation
score, column 3 and 4 the Fisher z-score and the number of standard
deviations. The table is created with values taken from the file <code class="highlighter-rouge">solutions.out</code>.</li>
  <li><code class="highlighter-rouge">Fit N</code>: Summary of the previous table for the 10 best fitted structures according to the cross correlation score. 
A PDB of the solution can be downloaded and 6 images of the PDB within the density map are shown, covering different 
views over the scene.</li>
</ul>

<p>If you don’t’ want to wait for your run to complete, you can access the precalculated results of a run submitted 
with the same input <a href="http://milou.science.uu.nl/cgi/services/POWERFIT/powerfit/example" title="Powerfit tutorial results page" target="_blank">here</a>.</p>

<p>The higher the cross-correlation score the better the fit. But also important is the Fisher z-score (the higher the better), 
which, together with its associated number of standard deviations (σ difference), is an excellent indicator of the accuracy of a fit 
(see for details <a href="https://doi.org/10.1016/j.jsb.2016.06.011" target="_blank">van Zundert and Bonvin, J. Struct. Biol. (2016)</a>
and PowerFit <a href="link-powerfit-help" target="_blank">help page</a>).
To enhance the interpretation of the results in the <code class="highlighter-rouge">Solutions</code> table, the entries are colored in a green gradient up to 
a sigma difference of 3.</p>

<figure align="center">
  <img width="400" src="/education/powerfit-webserver/sigma-difference.jpg" />
  <figcaption>The true-positive rate is given versus the difference in Fisher z-score standard deviations between the 
  top 2 solutions. The fitting results were binned in 6 bins, starting from 0 to 3 sigma with a step size of 0.5.</figcaption>
</figure>

<p>You can inspect online the results for the top 10 models (different views are provided). However, it is difficult to 
really appreciate the accuracy of PowerFit and the differences between the solutions with only images. 
Therefore download the results archive to your computer which is available at the top of your results page.</p>

<p>You will find in it the following files:</p>

<ul>
  <li><code class="highlighter-rouge">fit_N.pdb</code>: the best <em>N</em> fits, judged by the cross-correlation score.</li>
  <li><code class="highlighter-rouge">solutions.out</code>: all the non-redundant solutions found, ordered by their
cross-correlation score. The first column shows the rank, column 2 the correlation
score, column 3 and 4 the Fisher z-score and the number of standard
deviations; column 5 to 7 are the x, y and z coordinate of the center of the
chain; column 8 to 17 are the rotation matrix values.</li>
  <li><code class="highlighter-rouge">lcc.mrc</code>: a cross-correlation map showing, at each grid position, the 
highest cross-correlation score found during the search, thus showing the most 
likely location of the center of mass of the structure.</li>
  <li><code class="highlighter-rouge">powerfit.log</code>: a log file of the calculation, including the input parameters 
with date and timing information.</li>
</ul>

<p>Let us now inspect the solutions in Chimera.</p>

<p><a class="prompt prompt-info">
  Open the density map, the <em>lcc.mrc</em> cross-correlation map, and the 10 
best-ranked solutions in Chimera.
</a></p>

<p>Use for this either the <code class="highlighter-rouge">Menus</code> or the <code class="highlighter-rouge">command line interface</code> as explained <a href="#inspecting-the-data">before</a>, e.g.:</p>

<p><a class="prompt prompt-pymol">
  open /path/to/ribosome-RsgA.map
</a>
<a class="prompt prompt-pymol">
  open /path/to/lcc.mrc
</a>
<a class="prompt prompt-pymol">
  open /path/to/ribosome.pdb
</a>
<a class="prompt prompt-pymol">
  open /path/to/fit_*.pdb
</a></p>

<p>Make the density map transparent again, by adjusting the alpha channel value to
0.6. The values of the <code class="highlighter-rouge">lcc.mrc</code> slider bar correspond to the cross-correlation
score found. In this way, you can selectively visualize regions of high or low
cross-correlation values: i.e., pushing the slider to the right (higher cutoff)
shows only regions of the grid with high cross-correlation scores.</p>

<p>As you can see, PowerFit found quite some local optima, one of which stands out
(if the rotational search was tight enough). Further, the 10 best-ranked
solutions are centered on regions corresponding to local cross-correlation maxima.</p>

<p>To view each fitted solution individually, open the <code class="highlighter-rouge">Model Panel</code> window.</p>

<p><a class="prompt prompt-pymol">
Favorites → Model Panel
</a></p>

<p>The window shows each model
and its associated color that Chimera has processed. To show or hide a specific
model you can click the box in the <code class="highlighter-rouge">S</code> column.</p>

<p><a class="prompt prompt-info">
  Go through the 10 solutions one by one to asses their goodness-of-fit
  with the density.
</a></p>

<p><a class="prompt prompt-question">
  Do you agree with what PowerFit proposes as the best solution?
</a></p>

<p><a class="prompt prompt-info">
  In a new Chimera session, reopen the density map and the fit that you find 
best.
</a></p>

<p>Use for this either the <code class="highlighter-rouge">Menus</code> or the <code class="highlighter-rouge">Command Line</code>option to load the following files:</p>

<ul>
  <li><code class="highlighter-rouge">ribosome-RsgA.map</code></li>
  <li><code class="highlighter-rouge">ribosome.pdb</code></li>
  <li><code class="highlighter-rouge">fit_?.pdb</code></li>
</ul>

<p>Replace <em>?</em> by the appropriate solution number.</p>

<p><strong>Note</strong>: Make sure to load the files in the specified order for the subsequent commands 
to work on the correct residues!</p>

<p>You now have combined the ribosome structure with the rigid-body fit of RsgA
calculated by PowerFit, yielding an initial model of the complex. Take a closer look at residues <code class="highlighter-rouge">R47</code> to <code class="highlighter-rouge">H51</code> 
which are contributing to the interface with the ribosome.</p>

<p>In the command line of Chimera, type the
following instructions to center your view on these residues and highlight
their interactions:</p>

<p><a class="prompt prompt-pymol">
  show #2:47-51 zr&lt;5 &amp; #1 || #2:47-51<br />
  focus #2:47-51 zr&lt;5 &amp; #1 || #2:47-51
</a>
<a class="prompt prompt-info">
  Take some time to inspect the model, paying particular attention to these five
  residues and their spatial neighbors.
</a>
<a class="prompt prompt-question">
  Are there any clashes between the ribosome and RsgA chains?
</a></p>

<p>Chimera also includes a tool to locally optimize the fit of a rigid structure 
against a given density map, which can be an additional help on top of the 
PowerFit calculations. Make the main display window active by clicking on it,</p>

<p><a class="prompt prompt-info">
Go to Tools → Volume data → Fit in Map
</a>
<a class="prompt prompt-info">
In the newly opened Fit in Map window, select the best-fitted structure of PowerFit (fit_?.pdb) as 
Fit model and the original density map (ribosome-RsgA.map) as the map.
</a>
<a class="prompt prompt-info">
Press Fit to start the optimization. 
</a></p>

<p><a class="prompt prompt-question">
  Does the Chimera local fit optimization tool improve the results of PowerFit?
</a></p>

<p>The scoring function used by Chimera to estimate the quality of the fit makes 
our model worse, increasing the number of clashes between the ribosomal RNA and 
RsgA. Click <code class="highlighter-rouge">Undo</code> in the <code class="highlighter-rouge">Fit in Map</code> window to undo the optimization.</p>

<p>Next, we will try to optimize the fit using the cross-correlation that Chimera 
provides.</p>

<p><a class="prompt prompt-info">
Click “Options” and check the “Use map simulated from atoms, resolution” box and fill in 9.8 for resolution. 
</a>
<a class="prompt prompt-info">
Check the “correlation” radio button and uncheck the “Use only data above contour level from first map”. 
</a>
<a class="prompt prompt-info">
Press “Fit”. 
</a></p>

<p><a class="prompt prompt-question">
  Does this second strategy improve the quality of the fit? If not, undo it 
again.
</a></p>

<h2 id="final-remarks">Final remarks</h2>

<p>We have demonstrated in this tutorial how to make use of the PowerFit web server to fit
atomic structures in cryo-EM map. 
The obvious limitation of rigid-body fitting is that it cannot account for any
conformational changes that the structures might undergo. Further, the low
resolution of this particular density map does not allow to identify
side-chain atoms. The quality of the fitted models by PowerFit is, therefore,
limited. In particular, such models will typically result in a significant clashes at the interface between molecules.
Such clashes can be removed by making use of the HADDOCK-EM flexible refinement capabilities.
This is demonstrated in the <a href="http://bonvinlab.org/education/powerfit#HADDOCK-cryoEM" title="HADDOCK with cryoEM data" target="_blank">command line version</a> of the PowerFit tutorial and described in:</p>

<ul>
  <li>G.C.P. van Zundert, A.S.J. Melquiond and A.M.J.J. Bonvin.
<a href="https://doi.org/10.1016/j.str.2015.03.014" target="_blank">Integrative modeling of biomolecular complexes: HADDOCKing with Cryo-EM data.</a>
<em>Structure.</em> <em>23</em>, 949-960 (2015).</li>
</ul>

<p>Thank you for following this tutorial. If you have any questions or suggestions, feel free to contact us via email, or post your question to
our <a href="http://ask.bioexcel.eu/c/powerfit" target="_blank">PowerFit forum</a> hosted by the <a href="http://bioexcel.eu" target="_blank"><img width="70" src="/images/Bioexcel_logo.png" /></a> center of excellence
for computational biomolecular research.</p>

