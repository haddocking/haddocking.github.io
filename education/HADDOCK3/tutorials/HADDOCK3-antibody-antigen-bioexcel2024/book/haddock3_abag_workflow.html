<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Setting up a haddock3 docking workflow - HADDOCK3-antibody-antigen</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="shared/intro/haddock.html"><strong aria-hidden="true">1.</strong> High Ambiguity Driven DOCKing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="shared/intro/haddock.html"><strong aria-hidden="true">1.1.</strong> HADDOCK</a></li><li class="chapter-item expanded "><a href="shared/intro/haddock3.html"><strong aria-hidden="true">1.2.</strong> Haddock3</a></li></ol></li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">2.</strong> Antibody-antigen</a></li><li class="chapter-item expanded "><a href="shared/install/haddock3.html"><strong aria-hidden="true">3.</strong> Software, Requirements</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="shared/install/haddock3.html"><strong aria-hidden="true">3.1.</strong> Installing haddock3</a></li><li class="chapter-item expanded "><a href="shared/intall/auxiliary_software.html"><strong aria-hidden="true">3.2.</strong> Auxiliary software</a></li></ol></li><li class="chapter-item expanded "><a href="software_and_data.html"><strong aria-hidden="true">4.</strong> Starting data</a></li><li class="chapter-item expanded "><a href="prepare_antibody.html"><strong aria-hidden="true">5.</strong> Preparing input files</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="prepare_antibody.html"><strong aria-hidden="true">5.1.</strong> Prepare the antibody structure</a></li><li class="chapter-item expanded "><a href="prepare_antigen.html"><strong aria-hidden="true">5.2.</strong> Prepare the antigen structure</a></li></ol></li><li class="chapter-item expanded "><a href="airs.html"><strong aria-hidden="true">6.</strong> Defining Ambiguous Interaction Restraints</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="antibody_paratope.html"><strong aria-hidden="true">6.1.</strong> Antibody paratope</a></li><li class="chapter-item expanded "><a href="antigen_epitope.html"><strong aria-hidden="true">6.2.</strong> Antigen epitope</a></li></ol></li><li class="chapter-item expanded "><a href="gen_airs.html"><strong aria-hidden="true">7.</strong> Generating Ambiguous Interaction Restraints</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="gen_airs.html"><strong aria-hidden="true">7.1.</strong> How AIRs are defined ?</a></li><li class="chapter-item expanded "><a href="validate_tbl.html"><strong aria-hidden="true">7.2.</strong> Validating your interaction restraints</a></li><li class="chapter-item expanded "><a href="restrain_bodies.html"><strong aria-hidden="true">7.3.</strong> Additional restraints for multi-chain proteins</a></li></ol></li><li class="chapter-item expanded "><a href="haddock3_abag_workflow.html" class="active"><strong aria-hidden="true">8.</strong> Haddock3 docking run</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="haddock3_abag_workflow.html" class="active"><strong aria-hidden="true">8.1.</strong> Setting up a haddock3 docking workflow</a></li><li class="chapter-item expanded "><a href="running_haddock3.html"><strong aria-hidden="true">8.2.</strong> Running haddock3</a></li></ol></li><li class="chapter-item expanded "><a href="outputs.html"><strong aria-hidden="true">9.</strong> Analysis of your docking run</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="outputs.html"><strong aria-hidden="true">9.1.</strong> Docking run outputs</a></li><li class="chapter-item expanded "><a href="clusters.html"><strong aria-hidden="true">9.2.</strong> Clustering results</a></li><li class="chapter-item expanded "><a href="scores.html"><strong aria-hidden="true">9.3.</strong> Scores and plots</a></li><li class="chapter-item expanded "><a href="contacts.html"><strong aria-hidden="true">9.4.</strong> Contact analysis</a></li><li class="chapter-item expanded "><a href="visualizing_models.html"><strong aria-hidden="true">9.5.</strong> Analysing models</a></li></ol></li><li class="chapter-item expanded "><a href="bonus_toc.html"><strong aria-hidden="true">10.</strong> BONUS: additional analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="arctic_3d_abag_bonus.html"><strong aria-hidden="true">10.1.</strong> Comparing contacts observed in litterature</a></li><li class="chapter-item expanded "><a href="ai_based_input_bonus.html"><strong aria-hidden="true">10.2.</strong> Using AI based methods to obtain input structures</a></li><li class="chapter-item expanded "><a href="ai_based_ensemble_docking.html"><strong aria-hidden="true">10.3.</strong> Performing ensemble docking</a></li><li class="chapter-item expanded "><a href="ai_based_abag_modelling.html"><strong aria-hidden="true">10.4.</strong> AI based modelling</a></li><li class="chapter-item expanded "><a href="abag_haddock3_webapp.html"><strong aria-hidden="true">10.5.</strong> Haddock3 web application</a></li></ol></li><li class="chapter-item expanded "><a href="shared/congratulations.html"><strong aria-hidden="true">11.</strong> Final words</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">HADDOCK3-antibody-antigen</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="setting-up-and-running-the-docking-with-haddock3"><a class="header" href="#setting-up-and-running-the-docking-with-haddock3">Setting up and running the docking with HADDOCK3</a></h2>
<p>Now that we have all required files at hand (PDB and restraints files), it is time to setup our docking protocol. In this tutorial, considering we have rather good information about the paratope and epitope, we will execute a fast HADDOCK3 docking workflow, reducing the non-negligible computational cost of HADDOCK by decreasing the sampling, without impacting too much the accuracy of the resulting models.</p>
<hr>
<h3 id="haddock3-workflow-definition"><a class="header" href="#haddock3-workflow-definition">HADDOCK3 workflow definition</a></h3>
<p>The first step is to create a HADDOCK3 configuration file that will define the docking workflow.
We will follow a classic HADDOCK workflow consisting of rigid body docking, semi-flexible refinement and final energy minimisation followed by clustering.</p>
<p>We will also integrate two analysis modules in our workflow:</p>
<ul>
<li><code>caprieval</code> will be used at various stages to compare models to either the best scoring model (if no reference is given) or a reference structure, which in our case we have at hand (<code>pdbs/4G6M_matched.pdb</code>). This will directly allow us to assess the performance of the protocol. In the absence of a reference, <code>caprieval</code> is still usefull to assess the convergence of a run and analyse the results.</li>
<li><code>contactmap</code> added as last module will generate contact matrices of both intra- and intermolecular contacts and a chordchart of intermolecular contacts for each cluster.</li>
</ul>
<p>Our workflow consists of the following modules:</p>
<ol>
<li><strong><code>topoaa</code></strong>: <em>Generates the topologies for the CNS engine and builds missing atoms</em></li>
<li><strong><code>rigidbody</code></strong>: <em>Preforms rigid body energy minimisation (<code>it0</code> in haddock2.x)</em></li>
<li><strong><code>caprieval</code></strong>: <em>Calculates CAPRI metrics (i-RMSD, l-RMSD, Fnat, DockQ) with respect to the top scoring model or reference structure if provided</em></li>
<li><strong><code>seletop</code></strong> : <em>Selects the top X models from the previous module</em></li>
<li><strong><code>flexref</code></strong>: <em>Preforms semi-flexible refinement of the interface (<code>it1</code> in haddock2.4)</em></li>
<li><strong><code>caprieval</code></strong></li>
<li><strong><code>emref</code></strong>: <em>Final refinement by energy minimisation (<code>itw</code> EM only in haddock2.4)</em></li>
<li><strong><code>caprieval</code></strong></li>
<li><strong><code>clustfcc</code></strong>: <em>Clustering of models based on the fraction of common contacts (FCC)</em></li>
<li><strong><code>seletopclusts</code></strong>: <em>Selects the top models of all clusters</em></li>
<li><strong><code>caprieval</code></strong></li>
<li><strong><code>contactmap</code></strong>: <em>Contacts matrix and a chordchart of intermolecular contacts</em></li>
</ol>
<p>The corresponding toml configuration file (provided in <code>workflows/docking-antibody-antigen-CDR-NMR-CSP.cfg</code>) looks like:</p>
<p>{% highlight toml %}</p>
<h1 id=""><a class="header" href="#">====================================================================</a></h1>
<h1 id="antibody-antigen-docking-example-with-restraints-from-the-antibody"><a class="header" href="#antibody-antigen-docking-example-with-restraints-from-the-antibody">Antibody-antigen docking example with restraints from the antibody</a></h1>
<h1 id="paratope-to-the-nmr-identified-epitope-on-the-antigen"><a class="header" href="#paratope-to-the-nmr-identified-epitope-on-the-antigen">paratope to the NMR-identified epitope on the antigen</a></h1>
<h1 id="-1"><a class="header" href="#-1">====================================================================</a></h1>
<h1 id="directory-in-which-the-scoring-will-be-done"><a class="header" href="#directory-in-which-the-scoring-will-be-done">Directory in which the scoring will be done</a></h1>
<p>run_dir = "run1-CDR-NMR-CSP"</p>
<h1 id="compute-mode"><a class="header" href="#compute-mode">Compute mode</a></h1>
<p>mode = "local"
ncores = 50</p>
<h1 id="self-contained-rundir-to-avoid-problems-with-long-filename-paths"><a class="header" href="#self-contained-rundir-to-avoid-problems-with-long-filename-paths">Self contained rundir (to avoid problems with long filename paths)</a></h1>
<p>self_contained = true</p>
<h1 id="post-processing-to-generate-statistics-and-plots"><a class="header" href="#post-processing-to-generate-statistics-and-plots">Post-processing to generate statistics and plots</a></h1>
<p>postprocess = true
clean = true</p>
<p>molecules =  [
"pdbs/4G6K_clean.pdb",
"pdbs/4I1B_clean.pdb"
]</p>
<h1 id="-2"><a class="header" href="#-2">====================================================================</a></h1>
<h1 id="parameters-for-each-stage-are-defined-below-prefer-full-paths"><a class="header" href="#parameters-for-each-stage-are-defined-below-prefer-full-paths">Parameters for each stage are defined below, prefer full paths</a></h1>
<h1 id="-3"><a class="header" href="#-3">====================================================================</a></h1>
<p>[topoaa]</p>
<p>[rigidbody]</p>
<h1 id="cdr-to-nmr-epitope-ambig-restraints"><a class="header" href="#cdr-to-nmr-epitope-ambig-restraints">CDR to NMR epitope ambig restraints</a></h1>
<p>ambig_fname = "restraints/ambig-paratope-NMR-epitope.tbl"</p>
<h1 id="restraints-to-keep-the-antibody-chains-together"><a class="header" href="#restraints-to-keep-the-antibody-chains-together">Restraints to keep the antibody chains together</a></h1>
<p>unambig_fname = "restraints/antibody-unambig.tbl"
sampling = 50</p>
<p>[caprieval]
reference_fname = "pdbs/4G6M_matched.pdb"</p>
<p>[seletop]</p>
<h1 id="selection-of-the-top-40-best-scoring-complexes"><a class="header" href="#selection-of-the-top-40-best-scoring-complexes">Selection of the top 40 best scoring complexes</a></h1>
<p>select = 40</p>
<p>[flexref]
tolerance = 5</p>
<h1 id="cdr-to-nmr-epitope-ambig-restraints-1"><a class="header" href="#cdr-to-nmr-epitope-ambig-restraints-1">CDR to NMR epitope ambig restraints</a></h1>
<p>ambig_fname = "restraints/ambig-paratope-NMR-epitope.tbl"</p>
<h1 id="restraints-to-keep-the-antibody-chains-together-1"><a class="header" href="#restraints-to-keep-the-antibody-chains-together-1">Restraints to keep the antibody chains together</a></h1>
<p>unambig_fname = "restraints/antibody-unambig.tbl"</p>
<p>[caprieval]
reference_fname = "pdbs/4G6M_matched.pdb"</p>
<p>[emref]
tolerance = 5</p>
<h1 id="cdr-to-nmr-epitope-ambig-restraints-2"><a class="header" href="#cdr-to-nmr-epitope-ambig-restraints-2">CDR to NMR epitope ambig restraints</a></h1>
<p>ambig_fname = "restraints/ambig-paratope-NMR-epitope.tbl"</p>
<h1 id="restraints-to-keep-the-antibody-chains-together-2"><a class="header" href="#restraints-to-keep-the-antibody-chains-together-2">Restraints to keep the antibody chains together</a></h1>
<p>unambig_fname = "restraints/antibody-unambig.tbl"</p>
<p>[caprieval]
reference_fname = "pdbs/4G6M_matched.pdb"</p>
<p>[clustfcc]
plot_matrix = true</p>
<p>[seletopclusts]</p>
<h1 id="selection-of-the-top-4-best-scoring-complexes-from-each-cluster"><a class="header" href="#selection-of-the-top-4-best-scoring-complexes-from-each-cluster">Selection of the top 4 best scoring complexes from each cluster</a></h1>
<p>top_models = 4</p>
<p>[caprieval]
reference_fname = "pdbs/4G6M_matched.pdb"</p>
<p>[contactmap]</p>
<h1 id="-4"><a class="header" href="#-4">====================================================================</a></h1>
<p>{% endhighlight %}</p>
<p>In this case, since we have information for both interfaces we use a low-sampling configuration file, which takes only a small amount of computational resources to run. From the sampling parameters in the above config file, you can see we are sampling only 50 models at each stage of the docking:</p>
<p>The initial <code>sampling</code> parameter at the rigid-body energy minimization (<em>rigidbody</em>) module is set to 50 models, of which only best the 40 are passed to the flexible refinement (<em>flexref</em>) module with the <em>seletop</em> module.
The subsequence flexible refinement (<em>flexref</em> module) and energy minimisation (<em>emref</em>) modules will use all models passed by the <em>seletop</em> module.
FCC clustering (<em>clustfcc</em>) is then applied to group together models sharing a consistent fraction of the interface contacts.
The top 4 models of each cluster are saved to disk (<em>seletopclusts</em>).
Multiple <em>caprieval</em> modules are executed at different stages of the workflow to check how the quality (and rankings) of the models change throughout the protocol.</p>
<p>To get a list of all possible parameters that can be defined in a specific module (and their default values) you can use the following command:</p>
<a class="prompt prompt-cmd">
haddock3-cfg -m \<module\-name\>
</a>
<p>Add the <code>-d</code> option to get a more detailed description of parameters and use the <code>-h</code> option to see a list of arguments and options.</p>
<a class="prompt prompt-question">
In the above workflow we see in three modules a *tolerance* parameter defined. Using the *haddock3-cfg* command try to figure out what this parameter does.
</a>
<p><em><strong>Note</strong></em> that, in contrast to HADDOCK2.X, we have much more flexibility in defining our workflow.
As an example, we could use this flexibility by introducing a clustering step after the initial rigid-body docking stage, selecting a given number of models per cluster and refining all of those.
For an example of this strategy see the BONUS 3 section about ensemble docking.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="restrain_bodies.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="haddock3_abag_workflow.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="restrain_bodies.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="haddock3_abag_workflow.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
